---
layout: post
title: Bash-скрипты. Часть 1
summary: Существуют разные командные оболочки, zsh, ksh, tcsh, но мы будем учить bash. Последовательно. Разбавляя теорию практикой.
featured-img:
categories: Linux Code Notes
tags: [ bash ]
---

Работая с Linux, невозможно не использовать Bash. Как правило, эта командная оболочка используется по умолчанию.
Помимо обработки введенных в терминал команд, Bash используют для написания разного рода сценариев (не к фильмам). Здесь можно найти целое поле, еще и непаханое, всяких задач, которые хотят, чтобы их решили с помощью Bash.
Кстати, стоит сразу сказать, что в этом поле, далеко не все задачи хотят, чтобы их решили с помощью Bash :)
Если ваш скрипт будет содержать кучи строк, вам не нравятся кавычки и экранирование, вам не нужно вызывать сторонние утилиты и использовать пайплайны, для вас важна скорость, вы много обрабатываете строковых переменных, то стоит взглянуть в сторону Python или Ruby.

В общем, завершая вводную часть, выделю основные тезисы:
* работаешь с Linux - знай Bash!
* для каждой задачи - свой инструмент, не стоит ограничиваться одним.

С чего начать изучение Bash?
1. Найти книгу.
Для меня такой стала вот эта [книга](https://www.ozon.ru/context/detail/id/152987/){:target="_blank"}.
Да, не новая, но хуже она от этого не становится. Книга хорошо построена и даст вам отличную базу знаний; до сих пор использую её как справочник

2. Найти краткий курс, содержащий основы и практику.
Большую книгу тяжело сразу осилить, а краткий курс, содержащий основы, даст необходимую базу для быстрого перехода к практике; еще и "подогреет" интерес к дальнейшему изучению и погружению в тему.
Определенно стоит изучить [это](https://habr.com/company/ruvds/blog/325522/){:target="_blank"}, [а здесь pdf](https://habr.com/company/ruvds/blog/336764/){:target="_blank"}.
Можно еще [это](https://www.opennet.ru/docs/RUS/bash_scripting_guide/){:target="_blank"} почитать

3. Писать скрипты.
Любые. Автоматизируйте любую задачу на домашней или рабочей системе

Я учу Bash и, думаю, что, было бы прекрасно, дополнить [курс](https://habr.com/company/ruvds/blog/336764/){:target="_blank"} практическими задачами.

## Задача 1
**Темы:**
* [Bash-скрипты: начало](https://habr.com/company/ruvds/blog/325522/){:target="_blank"}
- [Bash-скрипты, часть 2: циклы](https://habr.com/company/ruvds/blog/325928/){:target="_blank"}

**Дополнительно изучить:**
- read
- find
- df

**Условие:** есть директория (~/Downloads), куда сохраняются абсолютно все загрузки. Та еще "файлопомойка". Скриптом необходимо копировать все новые файлы (которые хранятся не более 1 суток) на "флешку".
Чтобы усложнить задачу:
* покажем, куда примонтировалась флешка
* покажем свободное и занятое место
* проверим, есть ли на флешке директория MUSIC или Music, или MuSiC, или в любом регистре (будем использовать этот скрипт для копирования только что скачанной музыки): если такая директория есть, то системный диалог предложит залить туда найденные файлы. Согласишься - зальет, если нет - предложит залить в корень или ввести директорию, куда хочешь залить (добавим проверку на корректность введенной директории).


## Решение (+ комментарии)
Скрипт работает в Ubuntu и любой ОС, где флешка умеет монтироваться сама.
Не забудь добавить права на выполнение: sudo chmod +x script.sh.

```
#!/bin/bash
IFS=$'\n' # разделители полей по умолчанию: пробел, табуляция, перенос строки; выбираем перенос строки

# новое, добавленное устройство (flash) будет последним в выводе df; выводим заголовок (первая строка df -h) и информацию об устройстве (последняя строка df -h)
	for flash in $(df -h) # поместим последнюю строку из вывода df -h в переменную flash
		do
		for title in $(df -h) # поместим первую строку из вывода df -h в переменную title
			do
			break # за счет остановки цикла в переменную title будет добавлена только первая строка из вывода df -h
		done
		sleep 0 # не делаем ничего, спим 0 секунд
	done
echo "Dude, perhaps, it's your flash: " # выводим последнее подключенное внешнее устройство (первая и последняя строка df -h)
echo $title # вывод первой строки df -h
echo $flash # вывод последней строки df -h

IFS=' ' # меняем разделитель полей на пробел

#помещаем в переменную flashfilesystem полный путь до директории, в которую смонтирована flash
	for flashfilesystem in $flash
		do
		sleep 0 # не делаем ничего, спим 0 секунд
	done
# проверяем, есть ли в корне устройства директория Music, MUSIC, да хоть mUsIc, с помощью регулярного выражения
	flashwithmusic=$(find $flashfilesystem -maxdepth 1 -name "[Mm][Uu][Ss][Ii][Cc]*" -print) # опция -maxdepth 1 указывает, что find не будет проверять поддиректории
	if [ $flashwithmusic ] # если каталог music есть, то записываем во flashwithmusic путь до каталога music на устройстве
		then
		sleep 0
	else
		flashwithmusic=$flashfilesystem # если каталога music нет, то предложим пользователю копировать в корень устройства; flashwithmusic = путь до корня flash
	fi

# спросим пользователя, хочет ли он использовать найденный ранее на устройстве каталог
	read -p "Dude! Can I copy your new music to this directory ($flashwithmusic)? (yes or no): " yourchoice # записываем ответ пользователя в переменную yourchoice
	if [ $yourchoice = 'yes' ] # проверяем ответ на yes
		then
		IFS=$'\n' # установим разделителем полей перенос строки
			for newmusic in $(find ~/Downloads/ -mtime -1 -type f -print) # в случае ответа yes находим в каталоге ~/Downloads/ файлы не старее 1 суток
				do
				echo "Copying..."
				cp $newmusic $flashwithmusic # копируем найденное из ~/Downloads/ в наш каталог с музыкой
			done
			echo "Enjoy your new music, Dude!" # Готово!
		else
		read -p "Sorry, Dude! Could you write a directory to copy?: " yourchoice # для ответа no или любого отличающегося от yes, предложим ввести полный путь до директории
			if [ -d $yourchoice ] # проверяем указанный путь (директория или нет)
			then
			IFS=$'\n'
				for newmusic in $(find ~/Downloads/ -mtime -1 -type f -print)
				do
				echo "Copying..."
				cp $newmusic $yourchoice # копируем найденное из ~/Downloads/ в указанную пользователем директорию
				done
				echo "Enjoy your new music, Dude!" # Готово!
			else
				echo "Dude! It's not correct directory!" # выводим сообщение о том, что введенный путь не является директорией
			fi
	fi
```
